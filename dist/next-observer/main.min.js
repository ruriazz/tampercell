!function(t){"function"==typeof define&&define.amd?define(t):t()}(function(){"use strict";class t{constructor(t={}){this.readyCallbackExecuted=!1,this.mutationCount=0,this.mutationTimer=null,this.observer=null,this.routeChangeCallbacks=[],this.routeLoadStartTime=0,this.config=Object.assign({timeout:15e3,checkInterval:100,debug:!0,minContentCheck:3,routeChangeDetection:!0,routeLoadTimeout:5e3},t),this.state={nextDetected:!1,contentLoaded:!1,scriptsLoaded:!1,imagesLoaded:!1,noMoreMutations:!1,firstPaint:!1,routeChangeInProgress:!1,currentRoute:window.location.pathname,previousRoute:""},this.init()}log(...t){this.config.debug&&console.log("[Next.js Observer]",...t)}onNextJsReady(){if(this.readyCallbackExecuted)return;this.readyCallbackExecuted=!0,this.log("✅ Next.js Application is READY!"),this.log("State:",this.state),this.log("Timing:",performance.now().toFixed(2),"ms");const t={state:this.state,timestamp:Date.now(),timing:performance.now()};window.dispatchEvent(new CustomEvent("nextjs:ready",{detail:t}))}detectNextJs(){if(this.state.nextDetected)return!0;if(window.__NEXT_DATA__)return this.log("✓ Detected via __NEXT_DATA__"),this.state.nextDetected=!0,!0;const t=document.querySelectorAll('script[src*="/_next/"]');if(t.length>0)return this.log("✓ Detected via _next scripts:",t.length),this.state.nextDetected=!0,!0;const e=document.querySelector('meta[name="generator"]');if(e&&e.content.includes("Next.js"))return this.log("✓ Detected via meta generator"),this.state.nextDetected=!0,!0;if(document.querySelector('[aria-live="assertive"]#__next-route-announcer__'))return this.log("✓ Detected via route announcer"),this.state.nextDetected=!0,!0;return!!Array.from(document.scripts).some(t=>t.src.match(/\/_next\/static\/[a-zA-Z0-9_-]+\//))&&(this.log("✓ Detected via buildId pattern"),this.state.nextDetected=!0,!0)}checkContentLoaded(){if(this.state.contentLoaded)return!0;const{body:t}=document;if(!t)return!1;const e=t.querySelectorAll('main, article, section, [role="main"], .container, #root, [id*="app"], [id*="root"]');if(e.length>0){let t=0,o=0;if(e.forEach(e=>{var n;const s=(null===(n=e.textContent)||void 0===n?void 0:n.trim())||"";t+=s.length,s.length>10&&o++}),o>=this.config.minContentCheck||t>100)return this.log("✓ Content loaded:",o,"elements,",t,"chars"),this.state.contentLoaded=!0,!0}return t.children.length>5&&(this.log("✓ Content loaded via body children:",t.children.length),this.state.contentLoaded=!0,!0)}checkScriptsLoaded(){var t;if(this.state.scriptsLoaded)return!0;if(0===document.querySelectorAll('script[src*="/_next/"]').length)return!1;if((null===(t=window.__NEXT_DATA__)||void 0===t?void 0:t.props)||window.next)return this.log("✓ Scripts loaded (Next.js runtime available)"),this.state.scriptsLoaded=!0,!0;return!(!document.querySelector("[data-reactroot], [data-reactid]")&&!document.body.querySelector('*[class*="__"]'))&&(this.log("✓ Scripts loaded (React detected)"),this.state.scriptsLoaded=!0,!0)}checkImagesLoaded(){if(this.state.imagesLoaded)return!0;const t=document.querySelectorAll("img");if(0===t.length)return this.state.imagesLoaded=!0,!0;let e=0;t.forEach(t=>{t.complete&&t.naturalHeight>0&&e++});return e/t.length*100>=80&&(this.log("✓ Images loaded:",e,"/",t.length),this.state.imagesLoaded=!0,!0)}checkFirstPaint(){if(this.state.firstPaint)return!0;if(window.PerformanceObserver)try{new PerformanceObserver(t=>{for(const e of t.getEntries())"first-contentful-paint"===e.name&&(this.log("✓ First Contentful Paint:",e.startTime.toFixed(2),"ms"),this.state.firstPaint=!0)}).observe({entryTypes:["paint"]})}catch(t){this.state.firstPaint=!0}return!!(document.body&&document.body.children.length>0)&&(this.state.firstPaint=!0,!0)}checkIfReady(){const t=this.detectNextJs(),e=this.checkContentLoaded(),o=this.checkScriptsLoaded(),n=this.checkImagesLoaded(),s=this.checkFirstPaint();return!!(t&&e&&o&&s&&n)}onMutationStable(){this.log("✓ DOM mutations stable"),this.state.noMoreMutations=!0,this.checkIfReady()&&(this.observer&&this.observer.disconnect(),this.onNextJsReady())}startObserving(){if(this.log("🔍 Starting observation..."),this.checkIfReady())return void this.onNextJsReady();this.observer=new MutationObserver(()=>{this.mutationCount++,this.mutationTimer&&clearTimeout(this.mutationTimer),this.mutationTimer=setTimeout(()=>this.onMutationStable(),500),this.checkIfReady()&&(this.observer&&this.observer.disconnect(),this.onNextJsReady())}),this.observer.observe(document.documentElement,{childList:!0,subtree:!0,attributes:!1,characterData:!1});let t=0;const e=setInterval(()=>{t++,this.checkIfReady()&&(clearInterval(e),this.observer&&this.observer.disconnect(),this.onNextJsReady()),t*this.config.checkInterval>=this.config.timeout&&(clearInterval(e),this.observer&&this.observer.disconnect(),this.log("⚠️ Timeout reached"),this.state.nextDetected&&(this.log("Forcing ready callback (Next.js detected)"),this.onNextJsReady()))},this.config.checkInterval)}attachImageListeners(){window.addEventListener("load",()=>{this.log("✓ Window load event"),this.state.imagesLoaded=!0,this.checkIfReady()&&(this.observer&&this.observer.disconnect(),this.onNextJsReady())})}init(){this.log("Next.js Observer initialized"),this.attachImageListeners(),this.setupRouteChangeDetection(),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{this.log("✓ DOMContentLoaded"),this.startObserving()}):this.startObserving();new MutationObserver(()=>{document.querySelectorAll('script[src*="/_next/"]').forEach(t=>{t.hasAttribute("data-loaded")||t.addEventListener("load",()=>{t.setAttribute("data-loaded","true")})})}).observe(document.documentElement,{childList:!0,subtree:!0}),this.setupRouteChangeDetection();const t={state:this.state,config:this.config,forceCheck:()=>this.checkIfReady(),forceReady:()=>this.onNextJsReady(),detectNext:()=>this.detectNextJs(),getCurrentRoute:()=>this.getCurrentRoute(),onRouteChange:t=>this.onRouteChange(t)};window.__nextObserver=t}onRouteChangeStart(t){const e=this.state.currentRoute;if(e===t)return;this.log("🔄 Route change starting:",e,"->",t),this.state.previousRoute=e,this.state.currentRoute=t,this.state.routeChangeInProgress=!0,this.routeLoadStartTime=performance.now(),this.state.contentLoaded=!1,this.state.scriptsLoaded=!1,this.state.imagesLoaded=!1,this.state.noMoreMutations=!1;const o={from:e,to:t,timestamp:Date.now()};window.dispatchEvent(new CustomEvent("nextjs:route:before-change",{detail:o})),this.routeChangeCallbacks.forEach(o=>{try{o(e,t)}catch(t){this.log("Error in route change callback:",t)}})}onRouteLoadComplete(){if(!this.state.routeChangeInProgress)return;this.log("✅ Route load complete:",this.state.currentRoute),this.state.routeChangeInProgress=!1;const t={route:this.state.currentRoute,timestamp:Date.now(),timing:performance.now()-this.routeLoadStartTime,state:Object.assign({},this.state)};window.dispatchEvent(new CustomEvent("nextjs:route:after-load",{detail:t}))}setupRouteChangeDetection(){var t;if(!this.config.routeChangeDetection)return;this.log("🔗 Setting up route change detection");const e=this;if(null===(t=window.next)||void 0===t?void 0:t.router){const{router:t}=window.next;t.events.on("routeChangeStart",t=>{e.onRouteChangeStart(t)}),t.events.on("routeChangeComplete",()=>{setTimeout(()=>{e.checkContentLoaded()?e.onRouteLoadComplete():e.startRouteLoadObservation()},100)}),t.events.on("routeChangeError",()=>{e.state.routeChangeInProgress=!1,e.log("❌ Route change error")})}window.addEventListener("popstate",()=>{const t=e.getCurrentRoute();t!==e.state.currentRoute&&(e.onRouteChangeStart(t),setTimeout(()=>e.startRouteLoadObservation(),100))});const o=history.pushState,n=history.replaceState;history.pushState=function(...t){const n=o.apply(this,t);return setTimeout(()=>{const t=window.location.pathname+window.location.search;t!==e.state.currentRoute&&(e.onRouteChangeStart(t),setTimeout(()=>e.startRouteLoadObservation(),100))},0),n},history.replaceState=function(...t){const o=n.apply(this,t);return setTimeout(()=>{const t=window.location.pathname+window.location.search;t!==e.state.currentRoute&&(e.onRouteChangeStart(t),setTimeout(()=>e.startRouteLoadObservation(),100))},0),o}}startRouteLoadObservation(){if(!this.state.routeChangeInProgress)return;this.log("👀 Starting route load observation");let t=0;const e=this.config.routeLoadTimeout/this.config.checkInterval,o=setInterval(()=>{t++;const n=this.checkContentLoaded(),s=this.checkScriptsLoaded(),i=this.checkImagesLoaded();if(n&&s&&i)return clearInterval(o),void this.onRouteLoadComplete();t>=e&&(clearInterval(o),this.log("⚠️ Route load timeout reached"),this.onRouteLoadComplete())},this.config.checkInterval)}forceCheck(){return this.checkIfReady()}forceReady(){this.onNextJsReady()}detectNext(){return this.detectNextJs()}getCurrentRoute(){return this.state.currentRoute}onRouteChange(t){this.routeChangeCallbacks.push(t)}}window.NextObserver=e=>{new t(e)}});
//# sourceMappingURL=main.min.js.map
